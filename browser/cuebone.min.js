/**
 * cuebone.js
 * https://github.com/audiotheme/cuebone
 *
 * @copyright Copyright (c) 2016 AudioTheme, LLC
 * @license MIT
 * @version 0.1.0
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.cuebone=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){"use strict";var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,f={},g=a("./src/adapters/jplayer"),h=a("./src/adapters/mediaelementjs");d.extend(f,{players:{},collection:{},controller:{},model:{}}),f.Events=d.extend({},e.Events),f.controller.Mediator=a("./src/controllers/mediator"),f.controller.Player=a("./src/controllers/player.js"),f.model.Track=a("./src/models/track.js"),f.collection.Tracks=a("./src/collections/tracks.js"),f.players=new f.controller.Mediator([],{events:f.Events}),f.players.jplayer=new g(f.players,f.Events),f.players.mediaelementjs=new h(f.players,f.Events),b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/adapters/jplayer":2,"./src/adapters/mediaelementjs":3,"./src/collections/tracks.js":4,"./src/controllers/mediator":5,"./src/controllers/player.js":6,"./src/models/track.js":7}],2:[function(a,b,c){(function(a){"use strict";function c(a,b){this.events=b,this.collection=a,this.model=d,this.initialize()}var d,e="undefined"!=typeof window?window.jQuery:"undefined"!=typeof a?a.jQuery:null,f="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,g="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null;d=g.Model.extend({defaults:{id:null,player:null},initialize:function(a,b){var c=this.get("player");this.events=b.events,c.on(e.jPlayer.event.play,f.bind(this.onPlay,this))},pause:function(){this.get("player").jPlayer("pause")},onPlay:function(){this.events.trigger("play",this)}}),c.prototype.initialize=function(){var a,b=this;f.isFunction(e.jPlayer)&&(a=e.jPlayer.prototype._init,e.jPlayer.prototype._init=function(){a.apply(this,arguments),b.register(this.internal.instance,this.element)},this.registerPlayers())},c.prototype.registerPlayers=function(){f.isFunction(e.jPlayer)&&f.each(e.jPlayer.prototype.instances,function(a,b){this.register(b,a)},this)},c.prototype.register=function(a,b){var c=new this.model({id:a,player:b},{events:this.events});this.collection.add(c)},b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,b,c){(function(a){"use strict";function c(a,b){this.events=b,this.collection=a,this.model=d,this.initialize()}var d,e="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,f="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null,g="undefined"!=typeof window?window.mejs:"undefined"!=typeof a?a.mejs:null;d=f.Model.extend({defaults:{id:null,player:null},initialize:function(a,b){this.events=b.events,this.get("player").$media.on("play",e.bind(this.onPlay,this))},pause:function(){this.get("player").pause()},onPlay:function(){this.events.trigger("play",this)}}),c.prototype.initialize=function(){var a,b=this;e.isUndefined(g)||(a=g.MediaElementPlayer.prototype.init,g.MediaElementPlayer.prototype.init=function(){a.apply(this,arguments),b.register(this)},this.registerPlayers())},c.prototype.registerPlayers=function(){e.isUndefined(g)||e.each(g.players,function(a){this.register(a)},this)},c.prototype.register=function(a){var b=new this.model({id:a.id,player:a},{events:this.events});this.collection.add(b)},b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window.jQuery:"undefined"!=typeof c?c.jQuery:null,f="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,g="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,h=a("../models/track.js");d=g.Collection.extend({model:h,initialize:function(a,b){this.options=f.extend({id:"cuebone-default-tracks"},b)},fetch:function(){var a,b=e.Deferred();return a=JSON.parse(localStorage.getItem(this.options.id)),null!==a&&this.reset(a),b.resolve(a).promise()},save:function(){localStorage.setItem(this.options.id,JSON.stringify(this.toJSON()))}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../models/track.js":7}],5:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null;c=e.Collection.extend({initialize:function(a,b){this.listenTo(b.events,"play",this.pauseOthers)},pauseOthers:function(a){d.chain(this.models).without(a).invoke("pause")}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,g=0,h=a("../collections/tracks");d=f.Model.extend({defaults:{id:null,currentTrackIndex:0,loop:!1,muted:!1,repeat:!1,shuffle:!1,volume:.8},initialize:function(a,b){var c=window.navigator.userAgent.toLowerCase();return this.mediaElement=document.createElement("audio"),this.options=e.extend({events:null,persist:!1,tracks:null},b),this.get("id")||(this.set("id","cuebone-player-"+g),this.options.persist=!1,g++),this.isAndroid=null!==c.match(/android/i),this.isiPad=null!==c.match(/ipad/i),this.isiPhone=null!==c.match(/iphone/i),this.isiOS=this.isiPhone||this.isiPad,this.current=new h,this.tracks=this.options.tracks||new h([{}]),delete this.options.tracks,this.options.persist&&(this.fetchTracks(),this.on("change",this.save,this),this.current.on("add change remove reset",this.save,this),this.tracks.on("add remove reset",this.tracks.save,this.tracks)),this.listenTo(this.current,"ended",this.onTrackEnded),this.listenTo(this.tracks,"reset",this.onTracksReset),this.fetch(),this},getCurrentTrack:function(){return this.current.first()},isMuted:function(){return!!this.get("muted")},loadTrack:function(a){var b=this.current.first();this.pause(),b&&(b.set("status","error"===b.get("status")?"error":"paused"),b.unload()),this.set("status","loading"),this.current.reset(a),a.media=this.mediaElement,a.load()},mute:function(){return this.current.first().mute(),this.set("muted",!0),this},nextTrack:function(){var a,b=this.get("currentTrackIndex");return a=this.get("shuffle")?Math.floor(Math.random()*this.tracks.length):b+1>=this.tracks.length?0:b+1,this.setCurrentTrack(a),this},pause:function(){return this.current.length&&this.current.first().pause(),this},play:function(){return this.options.events.trigger("play",this),this.current.first().play(),this},previousTrack:function(){var a=this.get("currentTrackIndex"),b=0>a-1?this.tracks.length-1:a-1;return this.setCurrentTrack(b),this},seekTo:function(a){return this.current.first().seekTo(a),this},setCurrentTrack:function(a){for(;a>=this.tracks.length;)a--;return a===this.get("currentTrackIndex")&&this.current.length||(this.set("currentTrackIndex",a),this.loadTrack(this.tracks.at(a))),this},setVolume:function(a){return this.current.first().setVolume(a),this.unmute(),this.set("volume",a),this},unmute:function(){return this.current.first().unmute(),this.set("muted",!1),this},fetch:function(){var a,b=this.get("id");return this.options.persist?(a=JSON.parse(localStorage.getItem(b)),null===a?void this.setCurrentTrack(this.get("currentTrackIndex")):(this.setCurrentTrack(a.currentTrackIndex),this.seekTo(a.currentTime),this.set({loop:a.loop,repeat:a.repeat,shuffle:a.shuffle}),void("playing"!==a.status||this.isAndroid||this.isiOS||this.play()))):void this.setCurrentTrack(this.get("currentTrackIndex"))},fetchTracks:function(){var a=this.get("id"),b=localStorage.getItem(a+"-signature");return"signature"in this.options&&b!==this.options.signature?(localStorage.removeItem(a),localStorage.removeItem(a+"-signature"),void localStorage.removeItem(a+"-tracks")):void this.tracks.fetch()},save:function(){var a,b,c=this.get("id");this.options.persist&&(a=this.toJSON(),a.currentTime=0,a.status="paused",this.current.length&&(b=this.current.first(),a.currentTime=b.get("currentTime"),a.status=b.get("status")),localStorage.setItem(c,JSON.stringify(a)),"signature"in this.options&&localStorage.setItem(c+"-signature",this.options.signature))},onTrackEnded:function(){this.get("repeat")?this.seekTo(0).play():this.get("currentTrackIndex")<this.tracks.length-1||this.get("loop")||this.get("shuffle")?(this.nextTrack().play(),this.play()):this.nextTrack().pause()},onTracksReset:function(){this.set("currentTrackIndex",null)}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../collections/tracks":4}],7:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window.jQuery:"undefined"!=typeof a?a.jQuery:null,e="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,f="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null;c=f.Model.extend({defaults:{title:"",artist:"",artwork_url:"",currentTime:0,download_url:"",duration:0,loaded:0,purchase_url:"",record_id:null,source:"",status:"",track_number:"",type:""},constructor:function(a){!e.has(a,"source")&&e.has(a,"stream_url")&&(a.source=a.stream_url),f.Model.apply(this,arguments)},initialize:function(a,b){this.canPlay=d.Deferred(),this.media=null,this.ready=d.when(this.canPlay),e.bindAll(this,"onEnded","onError","onLoadedMetadata","onPause","onPlaying","onReady","onTimeUpdate","updateLoaded")},getProgress:function(){var a=this.get("currentTime"),b=this.get("duration");return a/b},load:function(){return this.set("status","loading"),this.media?(this.media.setAttribute("preload","auto"),this.media.setAttribute("src",this.get("source")),this.media.setAttribute("type",this.get("type")),this.media.addEventListener("canplay",this.onReady),this.media.addEventListener("loadedmetadata",this.onReady),this.media.addEventListener("ended",this.onEnded),this.media.addEventListener("loadedmetadata",this.onLoadedMetadata),this.media.addEventListener("error",this.onError),this.media.addEventListener("pause",this.onPause),this.media.addEventListener("playing",this.onPlaying),this.media.addEventListener("loadedmetadata",this.onTimeUpdate),this.media.addEventListener("timeupdate",this.onTimeUpdate),this.media.addEventListener("progress",this.updateLoaded),this.media.addEventListener("timeupdate",this.updateLoaded),void this.media.load()):void this.set("status","error")},unload:function(){this.set("status","paused"),this.media.removeEventListener("canplay",this.onReady),this.media.removeEventListener("loadedmetadata",this.onReady),this.media.removeEventListener("ended",this.onEnded),this.media.removeEventListener("loadedmetadata",this.onLoadedMetadata),this.media.removeEventListener("error",this.onError),this.media.removeEventListener("pause",this.onPause),this.media.removeEventListener("playing",this.onPlaying),this.media.removeEventListener("loadedmetadata",this.onTimeUpdate),this.media.removeEventListener("timeupdate",this.onTimeUpdate),this.media.removeEventListener("progress",this.updateLoaded),this.media.removeEventListener("timeupdate",this.updateLoaded)},mute:function(){this.media.muted=!0},pause:function(){this.media&&this.media.pause(),this.set("status","paused")},play:function(){var a=this;this.ready.done(function(){a.media.play(),a.set("status","playing")})},seekTo:function(a){var b,c,f=d.Deferred(),g=this.media;e.isUndefined(a)||(this.ready=d.when(this.canPlay,f),c=function(){return 4===g.readyState?(g.currentTime=a,clearInterval(b),f.resolve(),!0):!1},c()||(b=setInterval(c,50)))},setVolume:function(a){this.media.volume=a},unmute:function(){this.media.muted=!1},onError:function(){this.set("status","error")},onEnded:function(){this.trigger("ended")},onLoadedMetadata:function(){this.set("duration",this.media.duration)},onPause:function(){this.set("status","paused")},onPlaying:function(){this.set("status","playing")},onReady:function(){this.canPlay.resolve(),this.set("status","ready")},onTimeUpdate:function(){this.media&&this.set("currentTime",this.media.currentTime)},updateLoaded:function(){var a;try{a=this.media.buffered.end(this.media.buffered.length-1),this.set("loaded",a/this.media.duration*100)}catch(b){}}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});